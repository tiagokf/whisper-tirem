<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whisper Online - Transcri√ß√£o de √Åudio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #111424; color: white; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; background: rgba(14, 229, 127, 0.1); padding: 30px; border-radius: 10px; border: 1px solid #0EE57F; }
        .header h1 { color: #0EE57F; margin-bottom: 10px; }
        .header img { max-height: 60px; margin-bottom: 15px; }
        .config { background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid rgba(14, 229, 127, 0.3); }
        .config h3 { margin-bottom: 15px; color: #0EE57F; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; color: white; }
        .form-group select, .form-group input { width: 100%; padding: 10px; border: 1px solid #0EE57F; border-radius: 5px; background: #111424; color: white; }
        .form-group select option { background: #111424; color: white; }
        .upload-area { background: rgba(255, 255, 255, 0.05); padding: 30px; border-radius: 10px; text-align: center; border: 2px dashed #0EE57F; margin-bottom: 20px; }
        .upload-area.dragover { border-color: #0EE57F; background: rgba(14, 229, 127, 0.1); }
        .file-input { display: none; }
        .upload-btn { background: #0EE57F; color: #111424; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: 600; }
        .upload-btn:hover { background: #0cc96b; }
        .transcribe-btn { background: #0EE57F; color: #111424; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 18px; width: 100%; margin-bottom: 20px; font-weight: 600; }
        .transcribe-btn:hover { background: #0cc96b; }
        .transcribe-btn:disabled { background: #666; cursor: not-allowed; }
        .progress { background: rgba(255, 255, 255, 0.1); border-radius: 5px; margin: 20px 0; height: 20px; overflow: hidden; }
        .progress-bar { background: #0EE57F; height: 100%; width: 0%; transition: width 0.3s; }
        .result { background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-top: 20px; border: 1px solid rgba(14, 229, 127, 0.3); }
        .result textarea { width: 100%; height: 200px; padding: 15px; border: 1px solid #0EE57F; border-radius: 5px; resize: vertical; background: rgba(255, 255, 255, 0.1); color: white; }
        .downloads { display: flex; gap: 10px; margin-top: 15px; }
        .download-btn { background: #0EE57F; color: #111424; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; display: inline-block; font-weight: 600; }
        .download-btn:hover { background: #0cc96b; }
        .segments { margin-top: 20px; }
        .segment { background: rgba(14, 229, 127, 0.1); padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 4px solid #0EE57F; color: white; }
        .hidden { display: none; }
        .error { background: rgba(220, 53, 69, 0.2); color: #ff6b6b; padding: 15px; border-radius: 5px; margin: 10px 0; border: 1px solid #ff6b6b; }
        .success { background: rgba(14, 229, 127, 0.2); color: #0EE57F; padding: 15px; border-radius: 5px; margin: 10px 0; border: 1px solid #0EE57F; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="/static/logo.png" alt="Logo" onerror="this.style.display='none'">
            <h1>üéôÔ∏è Whisper Online</h1>
            <p>Transcri√ß√£o de √°udio usando IA</p>
        </div>

        <div class="config">
            <h3>‚öôÔ∏è Configura√ß√µes</h3>
            <div class="form-group">
                <label>Tamanho do modelo:</label>
                <select id="modelSize">
                    <option value="tiny">Tiny (r√°pido)</option>
                    <option value="base">Base</option>
                    <option value="small">Small</option>
                    <option value="medium" selected>Medium (recomendado)</option>
                    <option value="large">Large (preciso)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Idioma:</label>
                <select id="language">
                    <option value="auto">Auto-detectar</option>
                    <option value="pt" selected>Portugu√™s</option>
                    <option value="en">Ingl√™s</option>
                    <option value="es">Espanhol</option>
                    <option value="fr">Franc√™s</option>
                </select>
            </div>
            <div class="form-group">
                <label>Precis√£o (1-10):</label>
                <input type="range" id="beamSize" min="1" max="10" value="5">
                <span id="beamValue">5</span>
            </div>
        </div>

        <div class="upload-area" id="uploadArea">
            <p>üìÅ Arraste um arquivo de √°udio aqui ou clique para selecionar</p>
            <p style="color: #666; font-size: 14px;">Formatos: MP3, WAV, M4A, OGG, FLAC, AAC, OPUS (m√°x. 100MB)</p>
            <p style="color: #25D366; font-size: 12px;">‚úÖ Suporte para √°udios do WhatsApp (.opus)</p>
            <input type="file" id="audioFile" class="file-input" accept=".mp3,.wav,.m4a,.ogg,.flac,.aac,.opus">
            <button class="upload-btn" onclick="document.getElementById('audioFile').click()">Selecionar Arquivo</button>
        </div>

        <div id="fileInfo" class="hidden">
            <p><strong>Arquivo:</strong> <span id="fileName"></span></p>
            <p><strong>Tamanho:</strong> <span id="fileSize"></span></p>
        </div>

        <button id="transcribeBtn" class="transcribe-btn" disabled onclick="transcribe()">üéØ Transcrever</button>

        <div id="progress" class="progress hidden">
            <div id="progressBar" class="progress-bar"></div>
        </div>

        <div id="result" class="result hidden">
            <h3>üìù Transcri√ß√£o:</h3>
            <textarea id="transcriptionText" readonly></textarea>
            <div class="downloads">
                <a id="downloadTxt" class="download-btn" href="#">üìÑ Baixar TXT</a>
                <a id="downloadSrt" class="download-btn" href="#">üì• Baixar SRT</a>
            </div>
            <div class="segments">
                <h4>üïê Segmentos:</h4>
                <div id="segmentsList"></div>
            </div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('audioFile');
        const fileInfo = document.getElementById('fileInfo');
        const transcribeBtn = document.getElementById('transcribeBtn');
        const beamSize = document.getElementById('beamSize');
        const beamValue = document.getElementById('beamValue');

        beamSize.oninput = () => beamValue.textContent = beamSize.value;

        // Drag & Drop
        uploadArea.ondragover = (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); };
        uploadArea.ondragleave = () => uploadArea.classList.remove('dragover');
        uploadArea.ondrop = (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            fileInput.files = e.dataTransfer.files;
            handleFile();
        };

        fileInput.onchange = handleFile;

        function handleFile() {
            const file = fileInput.files[0];
            if (file) {
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = (file.size / (1024*1024)).toFixed(1) + ' MB';
                fileInfo.classList.remove('hidden');
                transcribeBtn.disabled = false;
            }
        }

        async function transcribe() {
            const file = fileInput.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('audio', file);
            formData.append('model_size', document.getElementById('modelSize').value);
            formData.append('language', document.getElementById('language').value);
            formData.append('beam_size', document.getElementById('beamSize').value);

            transcribeBtn.disabled = true;
            transcribeBtn.textContent = '‚è≥ Transcrevendo...';
            document.getElementById('progress').classList.remove('hidden');
            
            // Simular progresso
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 90) progress = 90;
                document.getElementById('progressBar').style.width = progress + '%';
            }, 500);

            try {
                const response = await fetch('/transcribe', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                clearInterval(progressInterval);
                document.getElementById('progressBar').style.width = '100%';

                if (data.success) {
                    showResult(data);
                } else {
                    showError(data.error);
                }
            } catch (error) {
                clearInterval(progressInterval);
                showError('Erro de conex√£o: ' + error.message);
            }

            transcribeBtn.disabled = false;
            transcribeBtn.textContent = 'üéØ Transcrever';
        }

        function showResult(data) {
            document.getElementById('transcriptionText').value = data.transcription;
            
            // Downloads
            const filename = fileInput.files[0].name.split('.')[0];
            document.getElementById('downloadTxt').href = `/download/txt?text=${encodeURIComponent(data.transcription)}&filename=${filename}`;
            document.getElementById('downloadSrt').href = `/download/srt?srt=${encodeURIComponent(data.srt)}&filename=${filename}`;
            
            // Segmentos
            const segmentsList = document.getElementById('segmentsList');
            segmentsList.innerHTML = data.segments.map(seg => 
                `<div class="segment"><strong>${seg.start} ‚Üí ${seg.end}</strong><br>${seg.text}</div>`
            ).join('');

            document.getElementById('result').classList.remove('hidden');
            
            // Mostrar info do idioma
            const successMsg = document.createElement('div');
            successMsg.className = 'success';
            successMsg.innerHTML = `‚úÖ Idioma detectado: ${data.language} (confian√ßa: ${data.confidence})`;
            document.getElementById('result').insertBefore(successMsg, document.getElementById('result').firstChild);
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = '‚ùå ' + message;
            document.querySelector('.container').appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 5000);
        }
    </script>
</body>
</html>